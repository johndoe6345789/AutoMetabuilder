{
  "id": "game_tick_loop",
  "label": "meta.workflow_packages.game_tick_loop.label",
  "description": "meta.workflow_packages.game_tick_loop.description",
  "tags": ["game", "loop", "ticks"],
  "workflow": {
    "nodes": [
      {
        "id": "seed_messages",
        "type": "core.seed_messages",
        "outputs": {"messages": "messages"}
      },
      {
        "id": "map_ticks",
        "type": "utils.map_list",
        "inputs": {
          "items": ["tick_start", "tick_update", "tick_render"],
          "template": "Tick: {item}"
        },
        "outputs": {"items": "tick_lines"}
      },
      {
        "id": "reduce_ticks",
        "type": "utils.reduce_list",
        "inputs": {"items": "$tick_lines", "separator": "\\n"},
        "outputs": {"result": "tick_context"}
      },
      {
        "id": "append_tick_context",
        "type": "core.append_context_message",
        "inputs": {"messages": "$messages", "context": "$tick_context"},
        "outputs": {"messages": "messages"}
      },
      {
        "id": "main_loop",
        "type": "control.loop",
        "inputs": {"max_iterations": 3, "stop_when": "$no_tool_calls", "stop_on": "true"},
        "body": [
          {
            "id": "ai_request",
            "type": "core.ai_request",
            "inputs": {"messages": "$messages"},
            "outputs": {
              "response": "llm_response",
              "has_tool_calls": "has_tool_calls",
              "tool_calls_count": "tool_calls_count"
            }
          },
          {
            "id": "run_tool_calls",
            "type": "core.run_tool_calls",
            "inputs": {"response": "$llm_response"},
            "outputs": {"tool_results": "tool_results", "no_tool_calls": "no_tool_calls"}
          },
          {
            "id": "append_tool_results",
            "type": "core.append_tool_results",
            "inputs": {"messages": "$messages", "tool_results": "$tool_results"},
            "outputs": {"messages": "messages"}
          }
        ]
      }
    ]
  }
}
