{
  "id": "repo_scan_context",
  "label": "meta.workflow_packages.repo_scan_context.label",
  "description": "meta.workflow_packages.repo_scan_context.description",
  "tags": ["map", "reduce", "context"],
  "workflow": {
    "nodes": [
      {
        "id": "list_files",
        "type": "tools.list_files",
        "inputs": {"path": "."},
        "outputs": {"files": "repo_files"}
      },
      {
        "id": "filter_python",
        "type": "utils.filter_list",
        "inputs": {"items": "$repo_files", "mode": "regex", "pattern": "\\.py$"},
        "outputs": {"items": "python_files"}
      },
      {
        "id": "reduce_python",
        "type": "utils.reduce_list",
        "inputs": {"items": "$python_files", "separator": "\\n"},
        "outputs": {"result": "python_summary"}
      },
      {
        "id": "seed_messages",
        "type": "core.seed_messages",
        "outputs": {"messages": "messages"}
      },
      {
        "id": "append_repo_summary",
        "type": "core.append_context_message",
        "inputs": {"messages": "$messages", "context": "$python_summary"},
        "outputs": {"messages": "messages"}
      },
      {
        "id": "append_user_instruction",
        "type": "core.append_user_instruction",
        "inputs": {"messages": "$messages"},
        "outputs": {"messages": "messages"}
      },
      {
        "id": "ai_request",
        "type": "core.ai_request",
        "inputs": {"messages": "$messages"},
        "outputs": {
          "response": "llm_response",
          "has_tool_calls": "has_tool_calls",
          "tool_calls_count": "tool_calls_count"
        }
      },
      {
        "id": "run_tool_calls",
        "type": "core.run_tool_calls",
        "inputs": {"response": "$llm_response"},
        "outputs": {"tool_results": "tool_results", "no_tool_calls": "no_tool_calls"}
      },
      {
        "id": "append_tool_results",
        "type": "core.append_tool_results",
        "inputs": {"messages": "$messages", "tool_results": "$tool_results"},
        "outputs": {"messages": "messages"}
      }
    ]
  }
}
