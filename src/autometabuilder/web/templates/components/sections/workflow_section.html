{# Workflow section macro. #}
{% from "components/atoms/section_header.html" import section_header %}
{% from "components/organisms/workflow_templates.html" import workflow_templates with context %}
{% from "components/organisms/workflow_palette.html" import workflow_palette with context %}

{% macro workflow_section() -%}
<section id="workflow" class="amb-section">
    {{ section_header(t('ui.workflow.title', 'Workflow Builder'), t('ui.workflow.subtitle', "Design the bot's task execution pipeline")) }}

    {{ workflow_templates() }}

    <div class="row g-3">
        <div class="col-lg-4">
            {{ workflow_palette() }}
        </div>
        <div class="col-lg-8">
            <div class="amb-card">
                <div class="amb-card-header">
                    <h5><i class="bi bi-diagram-3"></i> {{ t('ui.workflow.card.title', 'Tasks & Steps') }}</h5>
                    <div>
                        <button type="button" class="btn btn-sm btn-outline-secondary" data-workflow-toggle>
                            <i class="bi bi-code-slash"></i> {{ t('ui.workflow.toggle_json', 'Toggle JSON') }}
                        </button>
                    </div>
                </div>
                <div class="amb-card-body">
                    <div id="workflow-builder" class="mb-3">
                        <button type="button" class="btn btn-primary" data-workflow-fallback>
                            <i class="bi bi-plus-lg"></i> {{ t('ui.workflow.add_node', 'Add Node') }}
                        </button>
                    </div>
                    <form action="/workflow" method="post" id="workflow-form">
                        <textarea id="workflow-content" name="content" class="form-control amb-code-editor d-none" rows="15">{{ workflow_content }}</textarea>
                        <div class="d-flex gap-2 mt-3">
                            <button type="submit" class="btn btn-success">
                                <i class="bi bi-save"></i> {{ t('ui.workflow.save', 'Save Workflow') }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
{%- endmacro %}
